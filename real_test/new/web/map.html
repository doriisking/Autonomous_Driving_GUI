<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Path Visualization</title>
  <link rel="stylesheet" href="static/leaflet.css" />
  <script src="static/leaflet.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <script>
  // 1️⃣ 지도 초기화
  const map = L.map('map').setView([37.40123, 127.10345], 18);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 22,
      attribution: '© OpenStreetMap'
  }).addTo(map);

  let pathLine = null;
  let startMarker = null;
  let endMarker = null;

  // 2️⃣ 서버에서 selected_path 불러오기
  async function loadPath() {
    const res = await fetch("/selected_path");
    const data = await res.json();

    if (!data.coords || data.coords.length === 0) {
      alert("No path data found!");
      return;
    }

    // 3️⃣ 좌표 변환 (lat, lon → LatLng)
    const latlngs = data.coords.map(c => L.latLng(c[0], c[1]));

    // 4️⃣ 지도에 경로 폴리라인 표시
    if (pathLine) map.removeLayer(pathLine);
    pathLine = L.polyline(latlngs, { color: 'blue', weight: 4 }).addTo(map);

    // 시작/끝 지점 마커
    if (startMarker) map.removeLayer(startMarker);
    if (endMarker) map.removeLayer(endMarker);
    startMarker = L.marker(latlngs[0]).addTo(map).bindPopup("Start");
    endMarker = L.marker(latlngs[latlngs.length - 1]).addTo(map).bindPopup("Goal");

    // 5️⃣ 경로에 맞게 지도 중심 조정
    map.fitBounds(pathLine.getBounds());
  }

  loadPath();
  </script>
</body>
</html>
